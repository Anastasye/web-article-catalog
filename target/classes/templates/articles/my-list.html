<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ —Å—Ç–∞—Ç—å–∏</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="header">
            <h1>üìö –ö–∞—Ç–∞–ª–æ–≥ —Å—Ç–∞—Ç–µ–π</h1>
            <div class="auth-section">
                <span th:text="${#authentication.name}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                <a th:href="@{/logout}" class="btn btn-logout">–í—ã–π—Ç–∏</a>
            </div>
        </header>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="main-nav">
            <a th:href="@{/}" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
            <a th:href="@{/articles}" class="nav-link">–í—Å–µ —Å—Ç–∞—Ç—å–∏</a>
            <a th:href="@{/articles/my}" class="nav-link active">–ú–æ–∏ —Å—Ç–∞—Ç—å–∏</a>
            <a th:href="@{/articles/add}" class="nav-link">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é</a>
            <a th:href="@{/user/profile}" class="nav-link">–ü—Ä–æ—Ñ–∏–ª—å</a>
        </nav>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <main>
            <section class="dashboard">
                <h2>–ú–æ–∏ —Å—Ç–∞—Ç—å–∏</h2>

                <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                <div th:if="${param.success}" class="alert alert-success">
                    –°—Ç–∞—Ç—å—è —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!
                </div>
                <div th:if="${param.error}" class="alert alert-error">
                    –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: <span th:text="${param.error}"></span>
                </div>
                <div th:if="${errorMessage}" class="alert alert-error">
                    [[${errorMessage}]]
                </div>

                <!-- –ü–æ–∏—Å–∫ -->
                <div class="search-section">
                    <form th:action="@{/articles/my}" method="get" class="search-form">
                        <div class="form-row">
                            <div class="form-group" style="flex: 2;">
                                <input type="text" name="query" th:value="${searchQuery}"
                                    placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä–∞–º –∏–ª–∏ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º..."
                                    class="form-control">
                            </div>
                            <div class="form-group">
                                <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
                                <a th:href="@{/articles/my}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>–í—Å–µ–≥–æ —Å—Ç–∞—Ç–µ–π</h4>
                        <p th:text="${userArticlesCount != null ? userArticlesCount : 0}">0</p>
                    </div>
                </div>

                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                <div class="articles-list">
                    <div class="results-header">
                        <h3>–ù–∞–π–¥–µ–Ω–æ —Å—Ç–∞—Ç–µ–π: <span th:text="${totalItems != null ? totalItems : 0}">0</span></h3>
                        <a th:href="@{/articles/add}" class="btn btn-primary">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é</a>
                    </div>

                    <!-- –ù–µ—Ç —Å—Ç–∞—Ç–µ–π -->
                    <div th:if="${articles != null && articles.empty}" class="no-results">
                        <p>–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç —Å—Ç–∞—Ç–µ–π. <a th:href="@{/articles/add}">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Å—Ç–∞—Ç—å—é</a></p>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç–µ–π -->
                    <div th:if="${articles != null && !articles.empty}" class="articles-grid">
                        <div th:each="article : ${articles}" class="article-card">
                            <h4 th:text="${article.title}">–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏</h4>
                            <p class="authors">
                                <strong>–ê–≤—Ç–æ—Ä—ã:</strong>
                                <span th:text="${article.authors}"></span>
                            </p>
                            <p class="meta">
                                <strong>–¢–µ–º–∞:</strong>
                                <span th:text="${article.topic != null ? article.topic : '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}"></span> |
                                <strong>–ì–æ–¥:</strong>
                                <span
                                    th:text="${article.publicationYear != null ? article.publicationYear : '–ù–µ —É–∫–∞–∑–∞–Ω'}"></span>
                            </p>
                            <p class="keywords" th:if="${article.keywords != null && !article.keywords.isEmpty()}">
                                <strong>–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞:</strong>
                                <span th:text="${article.keywords}"></span>
                            </p>
                            <div class="article-actions">
                                <a th:href="@{'/articles/view/' + ${article.id}}"
                                    class="btn btn-sm btn-info">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                                <a th:href="@{'/articles/edit/' + ${article.id}}"
                                    class="btn btn-sm btn-warning">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                                <a th:href="@{'/articles/download/' + ${article.id}}"
                                    class="btn btn-sm btn-primary">–°–∫–∞—á–∞—Ç—å PDF</a>
                                <form th:action="@{'/articles/delete/' + ${article.id}}" method="post"
                                    class="inline-form" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Ç–∞—Ç—å—é?');">
                                    <button type="submit" class="btn btn-sm btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                    <div th:if="${totalPages != null && totalPages > 1}" class="pagination">
                        <a th:if="${currentPage > 0}"
                            th:href="@{/articles/my(page=${currentPage - 1}, query=${searchQuery})}"
                            class="btn btn-sm">‚Üê –ù–∞–∑–∞–¥</a>

                        <span class="page-info">
                            –°—Ç—Ä–∞–Ω–∏—Ü–∞ <span th:text="${currentPage + 1}">1</span> –∏–∑
                            <span th:text="${totalPages}">1</span>
                        </span>

                        <a th:if="${currentPage < totalPages - 1}"
                            th:href="@{/articles/my(page=${currentPage + 1}, query=${searchQuery})}"
                            class="btn btn-sm">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
                    </div>
                </div>
            </section>
        </main>

</body>

</html>